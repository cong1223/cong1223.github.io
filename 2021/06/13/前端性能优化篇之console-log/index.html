<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="小聪忙"><meta name="copyright" content="小聪忙"><meta name="generator" content="Hexo 5.3.0"><meta name="theme" content="hexo-theme-yun"><title>前端性能优化篇之console.log | 聪忙的小站-Code &amp; Rock</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.22/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_ed8vp4atwoj.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});
</script><link rel="shortcut icon" type="image/svg+xml" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"cong1223.github.io","root":"/","title":"聪忙的小站","version":"1.4.0","mode":"auto","copycode":true,"page":{"isPost":true},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"algolia":{"appID":"FPFBIG0SN1","apiKey":"f75714621d5494f13edbe7a616932224","indexName":"hexo-blog","hits":{"per_page":8},"labels":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容: ${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/utils.js"></script><script src="/js/hexo-theme-yun.js"></script><script>(function(){
  var bp = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https') {
    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else {
    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})();</script><!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-M9KWR9L');</script><!-- End Google Tag Manager --><meta name="description" content="前言前端程序员几乎每天不是在打log就是在打log的路上，最近就在自己真实项目中遇到了一个console.log的坑，由此记录一下console.log过程中你需要了解的知识，少走弯路。 console.log真的是异步吗？很多人在开发过程中利用console.log调试都被它“骗过”，在监视一些复杂对象的时候，log呈现给我们的值可能与预期不符，如下：这时有人直接下定义：console.log是">
<meta property="og:type" content="article">
<meta property="og:title" content="前端性能优化篇之console.log">
<meta property="og:url" content="https://cong1223.github.io/2021/06/13/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%AF%87%E4%B9%8Bconsole-log/index.html">
<meta property="og:site_name" content="聪忙的小站-Code &amp; Rock">
<meta property="og:description" content="前言前端程序员几乎每天不是在打log就是在打log的路上，最近就在自己真实项目中遇到了一个console.log的坑，由此记录一下console.log过程中你需要了解的知识，少走弯路。 console.log真的是异步吗？很多人在开发过程中利用console.log调试都被它“骗过”，在监视一些复杂对象的时候，log呈现给我们的值可能与预期不符，如下：这时有人直接下定义：console.log是">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cong1223/cloudimg@master/img/20210613000954.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cong1223/cloudimg@master/img/20210613001444.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cong1223/cloudimg@master/img/20210613002808.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cong1223/cloudimg@master/img/20210613003410.png">
<meta property="og:image" content="https://segmentfault.com/img/bVZKJJ">
<meta property="og:image" content="https://segmentfault.com/img/bVZKJJ">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cong1223/cloudimg@master/img/20210613081509.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cong1223/cloudimg@master/img/20210613082254.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cong1223/cloudimg@master/img/20210613092055.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cong1223/cloudimg@master/img/20210613092202.png">
<meta property="article:published_time" content="2021-06-13T04:30:16.000Z">
<meta property="article:modified_time" content="2021-07-16T23:55:39.061Z">
<meta property="article:author" content="小聪忙">
<meta property="article:tag" content="性能优化">
<meta property="article:tag" content="debugger">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/cong1223/cloudimg@master/img/20210613000954.png"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="小聪忙"><img width="96" loading="lazy" src="/images/ghostwang.jpeg" alt="小聪忙"><span class="site-author-status" title="Looking for dawn.">🌑</span></a><div class="site-author-name"><a href="/about/">小聪忙</a></div><a class="site-name" href="/about/site.html">聪忙的小站-Code &amp; Rock</a><sub class="site-subtitle">记录分享前端领域技术博文</sub><div class="site-desciption"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">67</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">14</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">61</span></a></div><a class="site-state-item hty-icon-button" href="/about/#comment" title="留言板"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-clipboard-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://jq.qq.com/?_wv=1027&amp;k=g4dnBzs9" title="QQ 群 94500464" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/cong1223" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://weibo.com/5861177611" title="微博" target="_blank" style="color:#E6162D"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-weibo-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=436106908" title="网易云音乐" target="_blank" style="color:#C20C0C"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/94308826" title="哔哩哔哩" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://cdn.jsdelivr.net/gh/cong1223/cloudimg@master/img/20210131133736.png" title="微信公众号" target="_blank" style="color:#1AAD19"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-2-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:1215524451@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a><a class="links-item hty-icon-button" href="/girls/" title="喜欢的女孩子" style="color:hotpink"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-women-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#console-log%E7%9C%9F%E7%9A%84%E6%98%AF%E5%BC%82%E6%AD%A5%E5%90%97%EF%BC%9F"><span class="toc-number">2.</span> <span class="toc-text">console.log真的是异步吗？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E8%AE%BA1"><span class="toc-number">3.</span> <span class="toc-text">结论1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#console-log%E4%BC%9A%E5%BD%B1%E5%93%8D%E6%80%A7%E8%83%BD%E5%90%97%EF%BC%9F"><span class="toc-number">4.</span> <span class="toc-text">console.log会影响性能吗？</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E4%B8%80"><span class="toc-number">4.1.</span> <span class="toc-text">案例一</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E4%BA%8C"><span class="toc-number">4.2.</span> <span class="toc-text">案例二</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E8%AE%BA2"><span class="toc-number">5.</span> <span class="toc-text">结论2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E5%B0%8F%E6%8A%80%E5%B7%A7"><span class="toc-number">6.</span> <span class="toc-text">开发小技巧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E5%90%88%E6%A1%88%E4%BE%8B%E4%BA%8C%E5%81%9A%E6%80%A7%E8%83%BD%E8%B0%83%E8%AF%95"><span class="toc-number">7.</span> <span class="toc-text">结合案例二做性能调试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%90%AFlog%E6%A8%A1%E5%BC%8F%E4%B8%8B%EF%BC%9A"><span class="toc-number">7.1.</span> <span class="toc-text">开启log模式下：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E9%97%ADlog%E6%A8%A1%E5%BC%8F%E4%B8%8B%EF%BC%9A"><span class="toc-number">7.2.</span> <span class="toc-text">关闭log模式下：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2%E6%8E%92%E6%9F%A5%E6%96%B9%E6%B3%95%E4%BA%8C"><span class="toc-number">7.3.</span> <span class="toc-text">内存泄露排查方法二</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%89%E8%B6%A3-%E6%97%A0%E8%81%8A-%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">8.</span> <span class="toc-text">有趣(无聊)的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E8%AE%BA3"><span class="toc-number">9.</span> <span class="toc-text">结论3</span></a></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://cong1223.github.io/2021/06/13/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%AF%87%E4%B9%8Bconsole-log/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="小聪忙"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="聪忙的小站-Code &amp; Rock"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">前端性能优化篇之console.log</h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="创建时间：2021-06-13 12:30:16" itemprop="dateCreated datePublished" datetime="2021-06-13T12:30:16+08:00">2021-06-13</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <time title="修改时间：2021-07-17 07:55:39" itemprop="dateModified" datetime="2021-07-17T07:55:39+08:00">2021-07-17</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="本文字数"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-file-word-line"></use></svg></span> <span title="本文字数">2.5k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读时长"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-timer-line"></use></svg></span> <span title="阅读时长">9m</span></span></span><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category" href="/categories/javascript/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">javascript</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag" href="/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">性能优化</span></a><a class="tag" href="/tags/debugger/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">debugger</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>前端程序员几乎每天不是在打log就是在打log的路上，最近就在自己真实项目中遇到了一个<code>console.log</code>的坑，由此记录一下<code>console.log</code>过程中你需要了解的知识，少走弯路。</p>
<h3 id="console-log真的是异步吗？"><a href="#console-log真的是异步吗？" class="headerlink" title="console.log真的是异步吗？"></a>console.log真的是异步吗？</h3><p>很多人在开发过程中利用<code>console.log</code>调试都被它“骗过”，在监视一些复杂对象的时候，log呈现给我们的值可能与预期不符，如下：<br><img src="https://cdn.jsdelivr.net/gh/cong1223/cloudimg@master/img/20210613000954.png" alt="image-20210613000954349" loading="lazy"><br>这时有人直接下定义：<code>console.log</code>是异步的！其实这个问题在《你不知道的javascript中卷》第二部分异步和性能1.1节异步控制台部分有提及：</p>
<blockquote>
<p>并没有什么规范或一组需求指定console.* 方法族如何工作——它们并不是JavaScript 正式的一部分，而是由宿主环境（请参考本书的“类型和语法”部分）添加到JavaScript 中的。因此，不同的浏览器和JavaScript 环境可以按照自己的意愿来实现，有时候这会引起混淆。<br>尤其要提出的是，在某些条件下，某些浏览器的console.log(..) 并不会把传入的内容立即输出。出现这种情况的主要原因是，在许多程序（不只是JavaScript）中，I/O 是非常低速的阻塞部分。所以，（从页面/UI 的角度来说）浏览器在后台异步处理控制台I/O 能够提高性能，这时用户甚至可能根本意识不到其发生。</p>
</blockquote>
<p>我们得知道一点，JS中对象是引用类型，每次使用对象时，都只是使用了对象在堆中的引用。</p>
<p>当我们在使用<code>a.b.c = 2</code>改变了对象的属性值时，它在堆中c的值也变成了2，而当我们不展开对象看的时候，<code>console.log</code>打印的是对象当时的快照，所以我们看到的c属性值是没改变之前的1，展开对象时，它其实是重新去内存中读取对象的属性值，所以当我们展开对象后看到的c属性值是2。</p>
<h3 id="结论1"><a href="#结论1" class="headerlink" title="结论1"></a>结论1</h3><p>由此可见，<code>console.log</code>打印出来的内容并不是一定百分百可信的内容。一般对于基本类型<code>number</code>、<code>string</code>、<code>boolean</code>、<code>null</code>、<code>undefined</code>的输出是可信的。但对于Object等引用类型来说，则就会出现上述异常打印输出。<br>如果改为<code>console.log(JSON.stringfy(obj))</code>则会打印出当前对象的快照，也就能拿到类似同步下的理想结果。更好的解决方案是使用断点进行调试，在那里执行完全停止，您可以检查每个点的当前值。仅对可序列化和不可变数据使用日志记录。</p>
<h3 id="console-log会影响性能吗？"><a href="#console-log会影响性能吗？" class="headerlink" title="console.log会影响性能吗？"></a>console.log会影响性能吗？</h3><p>通过上面的问题，可以反思一下：为什么你可以在控制台打印程序变量的快照？并且是引用类型的值时，展开对象会重新去内存读取对象的值？程序运行完后难道变量不应该被gc回收吗？</p>
<p>在传递给<code>console.log</code>的对象是不能被垃圾回收 ♻️，因为在代码运行之后需要在开发工具能查看对象信息。所以最好不要在生产环境<code>中console.log</code>任何对象。</p>
<h4 id="案例一"><a href="#案例一" class="headerlink" title="案例一"></a>案例一</h4><p>可以在控制台印证这一点：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Foo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> Foo());</span><br></pre></td></tr></table></figure>
<p>打开控制台<strong>Memory</strong>调试：</p>
<p><img src="https://cdn.jsdelivr.net/gh/cong1223/cloudimg@master/img/20210613001444.png" alt="image-20210613001444145" loading="lazy"></p>
<h4 id="案例二"><a href="#案例二" class="headerlink" title="案例二"></a>案例二</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">mounted () &#123;</span><br><span class="line">	this.handleSignCallback(&#123;</span><br><span class="line">      type: SIGNATURE_TYPES.SIGNATURE_GET_SIGN_STATUS,</span><br><span class="line">      success: true,</span><br><span class="line">      result: &#123;</span><br><span class="line">        longStr: new Array(1000000).join(&#39;*&#39;),</span><br><span class="line">        someMethod: function () &#123;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;,</span><br><span class="line">methods: &#123;</span><br><span class="line">  handleSignCallback(data) &#123;</span><br><span class="line">    const &#123; type, result, success &#125; &#x3D; data;</span><br><span class="line">    &#x2F;&#x2F; do something...</span><br><span class="line">    console.log(result) &#x2F;&#x2F; 返回结果打印</span><br><span class="line">    if (true) &#123; &#x2F;&#x2F; 真实项目中用来判断是否满足条件</span><br><span class="line">      this.timer &#x3D; setTimeout(() &#x3D;&gt; &#123;</span><br><span class="line">      this.handleSignCallback(&#123;</span><br><span class="line">        type: SIGNATURE_TYPES.SIGNATURE_GET_SIGN_STATUS,</span><br><span class="line">        success: true,</span><br><span class="line">        result: &#123;</span><br><span class="line">          longStr: new Array(1000000).join(&#39;*&#39;),</span><br><span class="line">          someMethod: function () &#123;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      clearTimeout(this.timer);</span><br><span class="line">    &#125;, 1000)</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p>真实项目在轮询中需要判断某些逻辑，满足条件了，会延迟几秒继续去请求后台，处理一些数据，直到返回的对象没有满足条件的数据才停止去请求拉数据，期间我想打印返回的数据，于是我加了<code>console.log(result)</code>，但是如果数据量大的话，执行一会就会程序崩溃，打开调试控制台-&gt;Memory：</p>
<p><img src="https://cdn.jsdelivr.net/gh/cong1223/cloudimg@master/img/20210613002808.png" alt="image-20210613002808312" loading="lazy"></p>
<p>js Heap在一直上升，无上限，直至浏览器崩溃；</p>
<p>但是当我注释<code>console.log(result)</code>这行 时，再次观察堆内存情况：</p>
<p><img src="https://cdn.jsdelivr.net/gh/cong1223/cloudimg@master/img/20210613003410.png" alt="image-20210613003410126" loading="lazy"></p>
<p>这时堆内存使用情况基本稳定在150左右。</p>
<h3 id="结论2"><a href="#结论2" class="headerlink" title="结论2"></a>结论2</h3><p>先给上述问题下个结论：<code>console.log</code>确实会影响网页性能。缘由请结合下述展开问题结合深究。</p>
<h3 id="开发小技巧"><a href="#开发小技巧" class="headerlink" title="开发小技巧"></a>开发小技巧</h3><p>针对结论二，大家应该都知道了，生产模式下尽量不要留<code>console.log</code>，也许大家现在公司里可能都是这么做的，但是你真的知道为什么这么做吗？下面举例<code>Vue</code>项目如何统一去除坑爹的<code>console.log</code>:</p>
<ol>
<li><p>安装babel-plugin-transform-remove-console</p>
<p><code>npm i  babel-plugin-transform-remove-console --dev</code></p>
</li>
<li><p>配置<code>babel.config.js</code>插件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// babel.config.js文件</span></span><br><span class="line"><span class="keyword">const</span> plugins = []</span><br><span class="line"><span class="comment">// 生产环境移除console</span></span><br><span class="line"><span class="keyword">if</span>(process.env.NODE_ENV === <span class="string">&#x27;production&#x27;</span> || process.env.NODE_ENV === <span class="string">&#x27;test&#x27;</span>) &#123;</span><br><span class="line">  plugins.push(<span class="string">&quot;transform-remove-console&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  presets: [</span><br><span class="line">    <span class="string">&#x27;@vue/app&#x27;</span></span><br><span class="line">  ],</span><br><span class="line">  plugins: [...plugins]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


</li>
</ol>
<h3 id="结合案例二做性能调试"><a href="#结合案例二做性能调试" class="headerlink" title="结合案例二做性能调试"></a>结合案例二做性能调试</h3><p>这里结合<strong>Chrome的Devtools–&gt;Performance</strong>做一些分析，操作步骤如下：</p>
<ol>
<li>开启Performance的记录</li>
<li>执行CG按钮，创建基准参考线</li>
<li>多次点击【click】按钮，新建Leaker对象</li>
<li>执行CG按钮</li>
<li>停止记录这里结合Chrome的Devtools–&gt;Performance做一些分析，操作步骤如下：<ol>
<li>开启Performance的记录</li>
<li>执行CG按钮，创建基准参考线</li>
<li>do something or create Object</li>
<li>执行CG按钮</li>
<li>停止记录</li>
</ol>
</li>
</ol>
<p><img src="https://segmentfault.com/img/bVZKJJ" alt="clipboard.png" loading="lazy"><img src="https://segmentfault.com/img/bVZKJJ" alt="clipboard.png" loading="lazy"></p>
<h4 id="开启log模式下："><a href="#开启log模式下：" class="headerlink" title="开启log模式下："></a>开启log模式下：</h4><p><img src="https://cdn.jsdelivr.net/gh/cong1223/cloudimg@master/img/20210613081509.png" alt="image-20210613081509239" loading="lazy"></p>
<blockquote>
<p>说明：测试代码由于模拟轮询场景，定时器触发频繁，可能出现gc的时间点js Heap高于基准线一点，主要看最后一次的js Heap跟第一次触发的线是不是差不多持平</p>
</blockquote>
<p>可以看到这里的<strong>js Heap</strong>（蓝色线，绿色线是nodes节点数量）一直在升高，并且我手动回收垃圾（gc）也无济于事 ，很明显，发生了内存泄露！</p>
<h4 id="关闭log模式下："><a href="#关闭log模式下：" class="headerlink" title="关闭log模式下："></a>关闭log模式下：</h4><p><img src="https://cdn.jsdelivr.net/gh/cong1223/cloudimg@master/img/20210613082254.png" alt="image-20210613082254800" loading="lazy"></p>
<p>关闭log后，观察js堆内存情况如上：可以看到，手动GC后两个时间点，js Heap基本恢复到同一水平线。</p>
<p>在普通场景下测试，例如开启记录-&gt;gc-&gt;点击事件，创建对象（N遍）-&gt;gc-&gt;停止记录，js Heap两个gc时间点基本重合。</p>
<h4 id="内存泄露排查方法二"><a href="#内存泄露排查方法二" class="headerlink" title="内存泄露排查方法二"></a>内存泄露排查方法二</h4><p>Heap Profiling可以记录当前的堆内存（heap）的快照，并生成对象的描述文件，该描述文件给出了当时JS运行所用的所有对象，以及这些对象所占用的内存大小、引用的层级关系等等。</p>
<p>JS运行的时候，会有栈内存（stack）和堆内存（heap），当我们new一个类的时候，这个new出来的对象就保存在heap里，而这个对象的引用则存储在stack里。程序通过stack的引用找到这个对象。例如：<code>var a = [1,2,3]</code>，a是存储在stack中的引用，heap里存储着内容为[1,2,3]的Array对象。</p>
<p>打开调试工具，点击Memory中的Profiles标签，选中“Take Heap Snapshot”,点击“start”按钮，就可以拍在当前JS的heap快照了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/cong1223/cloudimg@master/img/20210613092055.png" alt="img" loading="lazy"></p>
<p>右边视图中列出了heap里的对象列表。</p>
<p>constructor：类名<br>Distance：对象到根的引用层级距离<br>Objects Count：该类的对象数<br>Shallow Size：对象所占内存（不包含内部引用的其他对象所占的内存）<br>Retained Size：对象所占的总内存（包含····················································）<br>点击上图左上角的黑圈圈，会出现第二个内存快照<br><img src="https://cdn.jsdelivr.net/gh/cong1223/cloudimg@master/img/20210613092202.png" alt="img" loading="lazy"></p>
<p>将上图框框切换到<strong>comparison</strong>（对照）选项，该视图列出了当前视图与上一个视图的对象差异</p>
<p>New：新建了多少对象<br>Deleted：回收了多少对象<br>Delta：新建的对象个数减去回收的对象个数<br>重点看closure（闭包），如果#Delta为正数，则表示创建了闭包函数，如果多个快照中都没有变负数，则表示没有销毁闭包。</p>
<h3 id="有趣-无聊-的问题"><a href="#有趣-无聊-的问题" class="headerlink" title="有趣(无聊)的问题"></a>有趣(无聊)的问题</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;hello... there&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>运行以上代码，在大约 3 分钟左右的时间内，节点消耗了 1.5GB 的内存。</p>
<p>有人会说，死循环了能不引起内存飙升吗？</p>
<p>那看下面这个：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>():</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;hello world...&quot;</span></span><br><span class="line"></span><br><span class="line">hello()</span><br></pre></td></tr></table></figure>
<p><code>Python</code> 永远保持在 3.3MB。</p>
<p>有人可能会想到前面说的，<code>console.log</code>会引起内存泄露，但是前面说了是引用类型会造成内存泄露，这里直接打印字符串，为什么性能也会这么差？</p>
<p>简短回答：控制台输出是缓冲和异步的。并且除了全局内存限制外，缓冲区不受任何限制。因此，它填满缓冲区并死亡。<br>更多信息在<a target="_blank" rel="noopener" href="https://github.com/nodejs/node/issues/1741">#1741</a>。</p>
<p><em>“缓冲区”是指实际上是异步操作队列的隐式缓冲区。</em></p>
<ol>
<li>连接的检查器客户端将导致<code>console.log()</code>缓冲<em>有限</em>数量的消息</li>
<li>当您打印的速度比接收器（tty、管道、文件等）可以使用它们的速度快时，<code>Libuv </code>可以缓冲消息。这是您可以通过调整写入速度来解决的问题。</li>
</ol>
<blockquote>
<p><code>Libuv </code>：<em>Libuv是</em>一个高性能的，事件驱动的异步I/O库，它本身是由C语言编写的，具有很高的可移植性。</p>
</blockquote>
<h3 id="结论3"><a href="#结论3" class="headerlink" title="结论3"></a>结论3</h3><p>node开发时，在我们写入大型日志条目的情况下，写入文件进行日志记录是迄今为止最好的方法。服务稍后读取日志文件并将其聚合到适当的服务。</p>
</div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">我很可爱，请给我钱</div><div id="qr" style="display:none;"><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/cong1223/cloudimg@master/img/20210131143747.jpeg"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/cong1223/cloudimg@master/img/20210131143747.jpeg" alt="支付宝" title="支付宝"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/cong1223/cloudimg@master/img/20210131143944.jpeg"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/cong1223/cloudimg@master/img/20210131143944.jpeg" alt="QQ 支付" title="QQ 支付"></a><div><span style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/cong1223/cloudimg@master/img/20210131143746.jpeg"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/cong1223/cloudimg@master/img/20210131143746.jpeg" alt="微信支付" title="微信支付"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>小聪忙</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://cong1223.github.io/2021/06/13/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%AF%87%E4%B9%8Bconsole-log/" title="前端性能优化篇之console.log">https://cong1223.github.io/2021/06/13/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%AF%87%E4%B9%8Bconsole-log/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> 许可协议。</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2021/06/25/%E4%B8%80%E4%B8%AA%E5%9F%BA%E4%BA%8Evue%E7%9A%84%E5%9B%BE%E7%89%87%E8%A3%81%E5%89%AA%E5%92%8C%E5%8E%BB%E5%BA%95%E8%89%B2%E6%8F%92%E4%BB%B6/" rel="prev" title="一个基于vue的图片裁剪和去底色插件"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">一个基于vue的图片裁剪和去底色插件</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2021/06/12/js-%E6%A8%A1%E4%BB%BFwindows%E6%96%87%E4%BB%B6%E6%8E%92%E5%BA%8F%E8%A7%84%E5%88%99%E8%BF%9B%E8%A1%8C%E6%8E%92%E5%BA%8F/" rel="next" title="js模仿windows文件排序规则进行排序"><span class="post-nav-text">js模仿windows文件排序规则进行排序</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div id="comment"><div class="comment-tooltip text-center"><span>点击按钮跳转 GitHub Issues 评论。</span><br><span>若没有本文 Issue，您可以使用 Comment 模版新建。</span><br><a class="hty-button hty-button--raised" id="github-issues" target="_blank" rel="noopener" href="https://github.com/cong1223/cong1223.github.io/issues?q=is:issue+前端性能优化篇之console.log">GitHub Issues</a><a class="hty-button hty-button--raised" id="github-discussions" target="_blank" rel="noopener" href="https://github.com/cong1223/cong1223.github.io/discussions/new">GitHub Discussions</a></div><div id="disqus_thread"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/disqusjs@latest/dist/disqusjs.css"><script src="https://cdn.jsdelivr.net/npm/disqusjs@latest/dist/disqus.js"></script><script>const disqusjsConfig = {"enable":true,"shortname":"ghostwang-com"}
function loadDisqus() {
  const dsqjs = new DisqusJS(disqusjsConfig)
}</script><script src="/js/comments/disqus.js"></script></div></main><footer class="sidebar-translate" id="footer"><div class="beian"><a rel="noopener" href="https://beian.miit.gov.cn/" target="_blank">苏ICP备17038157号</a></div><div class="copyright"><span>&copy; 2021 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> 小聪忙</span></div></footer><a class="hty-icon-button" id="goUp" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="搜索"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search-line"></use></svg></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script defer src="https://cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script><script defer src="https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js"></script><script defer src="/js/search/algolia-search.js"></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-close-line"></use></svg></span></div><div class="search-input-container"></div><div class="algolia-results"><div id="algolia-stats"></div><div id="algolia-hits"></div><div class="algolia-pagination" id="algolia-pagination"></div></div></div></div></body></html>